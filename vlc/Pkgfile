# Description:  The cross-platform media player and streaming server
# URL:          https://www.videolan.org/vlc/
# Maintainer:   Lin SiFuh, #crux at freenode dot net
# Depends on:   ffmpeg liba52 libdvdnav libgcrypt libmad qt5 lua52
# Nice to have: opus libvorbis x264 libogg libmtp libtheora flac libvdpau

name=vlc
version=3.0.12
release=2
source=(https://download.videolan.org/pub/videolan/${name}/${version}/${name}-${version}.tar.xz
        srt_c.patch)

build() {

  cd "${name}"-"${version}"

  patch -Np1 < "${SRC}"/srt_c.patch

  [[ -z $(pkg-config --libs --static libavutil | grep -- '-lvdpau') ]] && \
    PKGMK_VLC+=' --disable-vdpau'

  autoreconf -fi

  export LUAC=/usr/bin/luac5.2
  export LUA_LIBS="$(pkg-config --libs lua5.2)"
  export RCC=/usr/bin/rcc-qt5
  eval PKGMK_VLC="($PKGMK_VLC)"

  sed -e 's|-Werror-implicit-function-declaration||g' -i configure

  BUILDCC="gcc -std=gnu11"          \
  ./configure "${PKGMK_VLC[@]}"     \
              --prefix=/usr         \
              --disable-nls         \
              --enable-alsa         \
              --disable-dbus        \
              --disable-fribidi     \
              --disable-update-check 

  V=1 ./compile

  make DESTDIR="${PKG}" install

  rm -rf "${PKG}"/usr/share/{doc,kde4}

  sed -i 's/--started-from-file//g'                 \
         "${PKG}"/usr/share/applications/vlc.desktop

}
