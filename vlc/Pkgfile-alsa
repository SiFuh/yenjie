# Description:  The cross-platform media player and streaming server
# URL:          https://www.videolan.org/vlc/
# Maintainer:   Lin SiFuh, #crux at freenode dot net
# Depends on:   ffmpeg liba52 libdvdnav libgcrypt libmad qt5 opus libvorbis x264 libogg libmtp libtheora flac libvdpau libavc1394 libraw1394 freerdp2 dav1d libupnp lua libbluray samba libssh2 libnfs libshout libebml libmatroska libmodplug mpg123 libva libvpx twolame libdca libmpeg2 schroedinger x265 librsvg jack-audio-connection-kit libsoxr chromaprint protobuf freetype xorg-libxpm xorg-libxext xorg-libxinerama avahi libsecret libnotify gtk3 libplacebo
# Optional: pulseaudio 

name=vlc
version=3.0.11
release=2
source=(https://download.videolan.org/pub/videolan/${name}/${version}/${name}-${version}.tar.xz \
        lua53_compat.patch qt_5_15.patch)

build() {

  cd ${name}-${version}

  patch -p1 -i ../lua53_compat.patch
  patch -p1 -i ../qt_5_15.patch

  [ -z "$(pkg-config --libs --static libavutil | grep -- '-lvdpau')" ] && PKGMK_VLC=' --disable-vdpau'

  autoreconf -fi

  export RCC=/usr/bin/rcc-qt5
  sed -e 's|-Werror-implicit-function-declaration||g' -i configure

  BUILDCC="gcc -std=gnu11" \
  ./configure ${PKGMK_VLC} \
    --prefix=/usr \
    --sysconfdir=/etc \
    --disable-rpath \
    --disable-dbus \
    --disable-nls \
    --enable-archive \
    --enable-dv1394 \
    --enable-dvdread \
    --enable-dvdnav \
    --enable-bluray \
    --disable-opencv \
    --enable-smbclient \
    --enable-sftp \
    --enable-nfs \
    --enable-realrtsp \
    --enable-ogg \
    --enable-shout \
    --enable-matroska \
    --enable-mod \
    --enable-mpc \
    --enable-mad \
    --enable-mpg123 \
    --enable-gst-decode \
    --enable-avcodec \
    --enable-libva \
    --enable-avformat \
    --enable-postproc \
    --enable-faad \
    --enable-vpx \
    --enable-twolame \
    --disable-fdkaac \
    --enable-a52 \
    --enable-dca \
    --enable-flac \
    --enable-libmpeg2 \
    --enable-vorbis \
    --enable-speex \
    --enable-opus \
    --enable-oggspots \
    --enable-schroedinger \
    --enable-png \
    --enable-jpeg \
    --enable-x264 \
    --enable-x265 \
    --enable-libass \
    --enable-vdpau \
    --enable-sdl-image \
    --enable-freetype \
    --enable-fribidi \
    --enable-harfbuzz \
    --enable-fontconfig \
    --enable-svg \
    --enable-svgdec \
    --enable-jack \
    --enable-samplerate \
    --enable-soxr \
    --enable-chromaprint \
    --enable-chromecast \
    --enable-qt \
    --enable-skins2 \
    --enable-libtar \
    --enable-ncurses \
    --enable-lirc \
    --enable-projectm \
    --enable-avahi \
    --enable-mtp \
    --enable-upnp \
    --enable-libxml2 \
    --enable-libgcrypt \
    --enable-gnutls \
    --enable-taglib \
    --enable-secret \
    --disable-update-check \
    --enable-notify \
    --enable-libplacebo \
    --enable-vlc \
    --enable-aribsub \
    --enable-alsa \
    --enable-dav1d 

  V=1 ./compile
  make DESTDIR=${PKG} install
  rm -rf ${PKG}/usr/share/doc
  rm -rf ${PKG}/usr/share/kde4 
  rm ${PKG}/usr/share/vlc/lua/http/requests/README.txt

  sed -i 's/--started-from-file//g' ${PKG}/usr/share/applications/vlc.desktop

}
